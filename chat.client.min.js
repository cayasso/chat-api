/*
 * Author: Jonathan Brumley
 * Date: 11/04/05
 * Time: 11:30PM MT
 */
(function(c){c.chat=function(h){var b={fields:{userid:"#userid",message:"#message"},action:null,userId:"",getInput:function(a,c){if(b.fields[a]&&c.find(b.fields[a]).length)return c.find(b.fields[a])[0].value;return null},onSuccess:function(a){b[b.action][a.status?"success":"error"](a);c(d.message).removeClass("error success").addClass(a.status?"success":"error").html(a.message)},onError:function(){c(d.message).html("Sorry, unable to load chat :( try again.").addClass("error")},send:function(a){if(typeof a.attr("action")!== "undefined")b.action=a.attr("action");else if(typeof a.attr("href")!=="undefined")b.action=a.attr("href");else return!1;b.action=b.action.replace("/chat/","").replace(/\?js=no-js|js=no-js/g,"");b.action&&b[b.action]&&(a=b[b.action].run(a),b.request(a));return!1},request:function(a){var f=a.url||null;a=a.data||"";if(f)c.ajax({type:"GET",dataType:"json",url:d.domain+f,data:a+"&js=true",success:b.onSuccess,error:b.onError,statusCode:b.onStatus});else return!1},"change-id.php":{success:function(){c(d.widget+ ", "+d.releaseLink+", "+d.recordsLink).show()},error:function(){},run:function(a){b.userId=b.getInput("userid",a);return{url:"/"+b.action,data:"id="+b.userId}}},"release-id.php":{success:function(){b.userId=""},error:function(){},run:function(){return{url:"/"+b.action,data:"id="+b.userId}}},"message.php":{success:function(a){c(d.chatArea).append("<br>"+a.time+"<hr /><strong>"+b.userId+": </strong>"+a.user_message+"<br>")},error:function(){},run:function(a){a=b.getInput("message",a);return{url:"/"+ b.action,data:"message="+a+"&id="+b.userId}}},"chat-records.php":{success:function(a){c(d.chatArea).html(a.data)},error:function(){},run:function(){return{url:"/"+b.action,data:""}}}},e={showForm:function(){var a=c(d.popin),b=c(".overlay");a.addClass("pp-content");if(c(".pp-wrap").length<1){a.wrap('<div class="pp-wrap" />');a.parent(".pp-wrap").css({display:"block"});var g=c("<span />",{"class":"pp-close-icon"});c("<a />",{"class":"pp-close-button",click:function(){e.hideForm()}}).html("X").appendTo(g); a.prepend(g)}a.show();c(".pp-wrap").css("display","block");b.length<1&&(b=c("<div/>",{"class":"overlay",css:{"overflow-y":"hidden"}}).prependTo("body").animate({opacity:"0.6"},200,"linear"))},hideForm:function(){c(".overlay").animate({opacity:"0"},200,"linear",function(){c(".pp-wrap").css("display","none");c(this).detach()})}},d={};d=c.extend({},{form:".chat-form",popin:".user-id-pop",startLink:".start-link",releaseLink:".release-link",recordsLink:".records-link",chatArea:".chat-area",domain:"http://localhost/chat-api/example", widget:".chat-widget",message:".chat-message"},h);(function(){c(d.startLink).click(function(){e.showForm();return!1});c(d.form).submit(function(){e.hideForm();return b.send(c(this))});c(d.releaseLink+", "+d.recordsLink).click(function(){b.send(c(this));return!1})})()}})(jQuery);

